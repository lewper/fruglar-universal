<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fruglar | Universal Orlando - Your Smartest Vacation, Your Lowest Price</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0066CC',
                        'primary-dark': '#004A99',
                        secondary: '#FF6B00',
                        accent: '#FFD700',
                        success: '#00C853',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        @keyframes shimmer {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }
        .shimmer {
            animation: shimmer 3s infinite;
        }
    </style>
</head>
<body class="bg-gray-50 font-sans antialiased">
    
    <!-- Navigation -->
    <nav class="fixed w-full bg-gradient-to-r from-primary to-primary-dark backdrop-blur-md shadow-lg z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex flex-col">
                    <div class="text-3xl font-black">
                        <span class="text-white">Frug</span><span class="text-accent">lar</span>
                    </div>
                    <div class="text-xs font-medium tracking-wider text-white/90 uppercase">Universal Orlando</div>
                </div>
                <div id="headerActions" class="flex items-center gap-3">
                    <!-- Dynamic content -->
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative h-screen flex items-center justify-center overflow-hidden pt-20">
        <div class="absolute inset-0 bg-gradient-to-br from-primary via-primary-dark to-purple-900"></div>
        <div class="absolute inset-0 bg-black/30"></div>
        
        <!-- Left Theme Park Image -->
        <div class="absolute left-0 top-1/2 -translate-y-1/2 w-1/4 h-96 hidden lg:block">
            <img src="https://images.unsplash.com/photo-1594736797933-d0501ba2fe65?w=600&h=800&fit=crop" alt="Universal Studios" class="w-full h-full object-cover opacity-30 rounded-r-3xl shadow-2xl">
        </div>
        
        <!-- Right Theme Park Image -->
        <div class="absolute right-0 top-1/2 -translate-y-1/2 w-1/4 h-96 hidden lg:block">
            <img src="https://images.unsplash.com/photo-1509600110300-21b9d5fedeb7?w=600&h=800&fit=crop" alt="Theme Park Ride" class="w-full h-full object-cover opacity-30 rounded-l-3xl shadow-2xl">
        </div>
        
        <div class="container relative z-20 text-center px-4 mx-auto">
            <h1 class="text-5xl md:text-7xl font-black text-white mb-6 leading-tight">
                Plan Your Perfect<br/>Universal Orlando Vacation
            </h1>
            <p class="text-xl md:text-2xl text-white/90 mb-10 max-w-3xl mx-auto font-medium">
                Live your fullest life for the lowest cost. Smart strategies that save you hundreds.
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center mb-8">
                <a href="#calculator" class="bg-secondary hover:bg-secondary/90 text-white px-10 py-4 rounded-full font-bold text-lg transition-all transform hover:scale-105 shadow-2xl">
                    Build Your Package
                </a>
                <a href="#tips" class="bg-white hover:bg-gray-100 text-gray-900 px-10 py-4 rounded-full font-bold text-lg transition-all transform hover:scale-105 shadow-2xl">
                    See Insider Tips
                </a>
            </div>
            <div id="heroStats" class="inline-block bg-gradient-to-r from-success to-green-600 text-white px-8 py-3 rounded-full font-bold text-lg shadow-2xl">
                üí∞ Average member savings: $847 per trip
            </div>
        </div>
    </section>

    <!-- Annual Pass ROI Section -->
    <section class="py-20 bg-white">
        <div class="container px-4 mx-auto max-w-7xl">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-black text-gray-900 mb-4">Should You Buy a Seasonal Pass?</h2>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                    Seasonal passes cost $304-$525, but unlock 40% hotel discounts and 15% food discounts. Let's see if it saves money.
                </p>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                <!-- Without Pass -->
                <div class="bg-gray-50 p-8 rounded-3xl shadow-lg">
                    <h3 class="text-2xl font-bold text-gray-900 mb-6">Without Seasonal Pass</h3>
                    <div class="space-y-4 mb-6">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">3-Day Tickets (x2)</span>
                            <span class="font-bold text-lg">$758</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">Hotel (3 nights @ $289)</span>
                            <span class="font-bold text-lg">$867</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">Food (3 days)</span>
                            <span class="font-bold text-lg">$420</span>
                        </div>
                    </div>
                    <div class="border-t-2 border-gray-200 pt-4">
                        <div class="flex justify-between items-center">
                            <span class="text-xl font-bold">Total</span>
                            <span class="text-3xl font-black text-gray-900">$2,045</span>
                        </div>
                    </div>
                </div>

                <!-- With Pass -->
                <div class="bg-gradient-to-br from-success/10 to-green-100 p-8 rounded-3xl shadow-xl border-4 border-success">
                    <h3 class="text-2xl font-bold text-success mb-6">‚úì With Seasonal Passes</h3>
                    <div class="space-y-4 mb-6">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700">Seasonal Passes (x2)</span>
                            <span class="font-bold text-lg">$608</span>
                        </div>
                        <div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Hotel (3 nights @ $173)</span>
                                <span class="font-bold text-lg text-success">$520</span>
                            </div>
                            <div class="text-sm text-success ml-4">40% discount applied</div>
                        </div>
                        <div>
                            <div class="flex justify-between items-center">
                                <span class="text-gray-700">Food (3 days)</span>
                                <span class="font-bold text-lg text-success">$357</span>
                            </div>
                            <div class="text-sm text-success ml-4">15% discount applied</div>
                        </div>
                    </div>
                    <div class="border-t-2 border-success pt-4">
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xl font-bold">Total</span>
                            <span class="text-3xl font-black text-success">$1,485</span>
                        </div>
                        <div class="bg-success text-white px-6 py-4 rounded-2xl text-center">
                            <div class="text-2xl font-black">You Save $560! üéâ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Return Trip Info -->
            <div class="bg-gradient-to-r from-primary/10 to-purple-100 p-8 rounded-3xl shadow-lg">
                <h3 class="text-2xl font-bold text-primary mb-4">üí∞ Planning a Return Trip? Save Even MORE</h3>
                <p class="text-gray-700 mb-6">
                    <strong>If you visit again within 12 months:</strong> Your passes are already paid for! You'd only pay for hotels (with 40% discount) and food (with 15% discount).
                </p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-2xl">
                        <div class="font-bold text-lg mb-2">Second Trip (3 nights):</div>
                        <div class="text-sm text-gray-600 mb-4">Hotel + Food only</div>
                        <div class="flex justify-between items-center">
                            <div class="text-3xl font-black text-success">$877</div>
                            <div class="text-sm text-gray-600">vs $1,287 without pass</div>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-success to-green-600 p-6 rounded-2xl text-white flex items-center justify-center">
                        <div class="text-center">
                            <div class="text-3xl font-black mb-2">Total Savings</div>
                            <div class="text-5xl font-black">$970</div>
                            <div class="text-lg">Across Both Trips!</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="annualPassCTA" class="text-center mt-12">
                <!-- Dynamic CTA will appear here -->
            </div>
        </div>
    </section>

    <!-- Price Tracking Dashboard -->
    <section class="py-20 bg-gray-100">
        <div class="container px-4 mx-auto max-w-7xl">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-black text-gray-900 mb-4">Current Prices</h2>
                <p class="text-xl text-gray-600">Track the latest rates and trends</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6" id="priceTracking">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Crowd Tracker -->
    <section class="py-20 bg-white">
        <div class="container px-4 mx-auto max-w-7xl">
            <div class="bg-gradient-to-br from-purple-50 to-blue-50 p-8 md:p-12 rounded-3xl shadow-xl border-2 border-primary/20">
                <div class="flex justify-between items-start mb-8">
                    <div>
                        <h2 class="text-3xl md:text-4xl font-black text-gray-900 mb-3">üìÖ Crowd Tracker</h2>
                        <p class="text-gray-600 text-lg">Find the cheapest window with lowest crowds</p>
                    </div>
                    <span class="bg-success text-white px-4 py-2 rounded-full text-sm font-bold">FREE</span>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                    <div>
                        <label class="block font-bold text-gray-900 mb-2">Flexible Month</label>
                        <select id="flexMonth" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                            <option value="">Select a month...</option>
                            <option value="2025-01">January 2025</option>
                            <option value="2025-02">February 2025</option>
                            <option value="2025-03">March 2025</option>
                            <option value="2025-06">June 2025</option>
                            <option value="2025-07">July 2025</option>
                            <option value="2025-09">September 2025</option>
                        </select>
                    </div>
                    <div>
                        <label class="block font-bold text-gray-900 mb-2">Trip Length</label>
                        <select id="tripLength" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                            <option value="3">3 Days / 2 Nights</option>
                            <option value="4">4 Days / 3 Nights</option>
                            <option value="5">5 Days / 4 Nights</option>
                            <option value="6">6 Days / 5 Nights</option>
                            <option value="7">7 Days / 6 Nights</option>
                            <option value="8">8 Days / 7 Nights</option>
                            <option value="9">9 Days / 8 Nights</option>
                            <option value="10">10 Days / 9 Nights</option>
                        </select>
                    </div>
                    <div>
                        <label class="block font-bold text-gray-900 mb-2">Priority</label>
                        <select id="datePriority" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                            <option value="price">Lowest Price</option>
                            <option value="crowds">Lowest Crowds</option>
                            <option value="balanced">Balanced (Price + Crowds)</option>
                        </select>
                    </div>
                </div>
                
                <button onclick="findOptimalDates()" class="bg-primary hover:bg-primary-dark text-white px-8 py-4 rounded-full font-bold text-lg transition-all transform hover:scale-105 shadow-lg">
                    üîç Find Best Dates
                </button>
                
                <div id="optimalDateResults" class="hidden mt-8">
                    <!-- Results will appear here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Calculator Section -->
    <section id="calculator" class="py-20 bg-gradient-to-br from-gray-50 to-blue-50">
        <div class="container px-4 mx-auto max-w-7xl">
            <div class="bg-white p-8 md:p-12 rounded-3xl shadow-2xl">
                <h2 class="text-3xl md:text-4xl font-black text-gray-900 mb-8">üßÆ Vacation Package Builder</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <!-- Left Column - Inputs -->
                    <div class="lg:col-span-2 space-y-6">
                        <!-- Trip Details -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block font-bold text-gray-900 mb-2">Check-In Date</label>
                                <input type="date" id="checkIn" onchange="calculatePackage()" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                            </div>
                            <div>
                                <label class="block font-bold text-gray-900 mb-2">Check-Out Date</label>
                                <input type="date" id="checkOut" onchange="calculatePackage()" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                            </div>
                            <div>
                                <label class="block font-bold text-gray-900 mb-2">Adults</label>
                                <input type="number" id="adults" value="2" min="1" max="10" onchange="calculatePackage()" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                            </div>
                            <div>
                                <label class="block font-bold text-gray-900 mb-2">Children (3-9)</label>
                                <input type="number" id="children" value="0" min="0" max="10" onchange="calculatePackage()" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                            </div>
                        </div>

                        <!-- Hotel Selection -->
                        <div class="bg-gray-50 p-6 rounded-2xl">
                            <div class="flex items-center gap-3 mb-4">
                                <input type="checkbox" id="needsHotel" onchange="calculatePackage()" checked class="w-5 h-5 text-primary rounded">
                                <label class="font-bold text-lg text-gray-900">üè® Hotel</label>
                            </div>
                            <select id="hotelType" onchange="calculatePackage()" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                                <option value="">Select...</option>
                                <optgroup label="Value ($99-145/nt)">
                                    <option value="99">Endless Summer - $99/nt</option>
                                    <option value="145">Cabana Bay - $145/nt</option>
                                    <option value="134">Stella/Terra Nova - $134/nt</option>
                                </optgroup>
                                <optgroup label="Preferred ($222/nt)">
                                    <option value="222">Sapphire Falls - $222/nt</option>
                                </optgroup>
                                <optgroup label="Premier - FREE Express ($386-421/nt)">
                                    <option value="421">Royal Pacific - $421/nt</option>
                                    <option value="386">Hard Rock - $386/nt</option>
                                    <option value="393">Portofino Bay - $393/nt</option>
                                </optgroup>
                            </select>
                        </div>

                        <!-- Tickets -->
                        <div class="bg-gray-50 p-6 rounded-2xl">
                            <label class="font-bold text-lg text-gray-900 mb-4 block">üé´ Tickets</label>
                            <div class="space-y-3">
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="radio" name="ticketType" value="none" onchange="calculatePackage()" class="w-5 h-5 text-primary">
                                    <span>Already have tickets</span>
                                </label>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="radio" name="ticketType" value="tickets" onchange="calculatePackage(); toggleTicketOptions()" checked class="w-5 h-5 text-primary">
                                    <span>Buy Day Tickets</span>
                                </label>
                                <select id="dayTickets" onchange="calculatePackage()" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors ml-8">
                                    <option value="349">2-Day - $349</option>
                                    <option value="379">3-Day - $379</option>
                                    <option value="409">4-Day - $409</option>
                                    <option value="435">5-Day - $435</option>
                                </select>
                                <label class="flex items-center gap-3 cursor-pointer">
                                    <input type="radio" name="ticketType" value="annual" onchange="calculatePackage(); toggleAnnualPassOptions()" class="w-5 h-5 text-primary">
                                    <span>Buy Annual Passes</span>
                                </label>
                                <select id="annualPass" onchange="calculatePackage()" class="hidden w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors ml-8">
                                    <option value="">Select...</option>
                                    <option value="424.99|seasonal|40|0">Seasonal 2-Park - $425 (40% hotels)</option>
                                    <option value="524.99|seasonal|40|15">Seasonal 3-Park - $525 (40% hotels+food)</option>
                                    <option value="474.99|power|30|0">Power 2-Park - $475 (30% hotels)</option>
                                    <option value="584.99|power|30|10">Power 3-Park - $585 (30% hotels+food)</option>
                                    <option value="629.99|preferred|0|10">Preferred 2-Park - $630 (10% parks)</option>
                                    <option value="739.99|preferred|0|10">Preferred 3-Park - $740 (10% parks)</option>
                                    <option value="904.99|premier|0|15">Premier 2-Park - $905 (15%+Express)</option>
                                    <option value="1094.99|premier|0|15">Premier 3-Park - $1,095 (15%+Express)</option>
                                </select>
                                <label class="flex items-center gap-3 cursor-pointer bg-green-50 p-3 rounded-xl">
                                    <input type="checkbox" id="hasExistingPass" onchange="calculatePackage(); toggleExistingPassOptions()" class="w-5 h-5 text-success">
                                    <span class="font-medium">Already have Annual Pass</span>
                                </label>
                                <select id="existingPassType" onchange="calculatePackage()" class="hidden w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors ml-8">
                                    <option value="">Select type...</option>
                                    <option value="seasonal|40|0">Seasonal 2-Park</option>
                                    <option value="seasonal|40|15">Seasonal 3-Park</option>
                                    <option value="power|30|0">Power 2-Park</option>
                                    <option value="power|30|10">Power 3-Park</option>
                                    <option value="preferred|0|10">Preferred</option>
                                    <option value="premier|0|15">Premier</option>
                                </select>
                            </div>
                        </div>

                        <!-- Additional Options -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Express Pass -->
                            <div class="bg-gray-50 p-6 rounded-2xl">
                                <div class="flex items-center gap-3 mb-4">
                                    <input type="checkbox" id="needsExpress" onchange="calculatePackage(); toggleExpressOptions()" class="w-5 h-5 text-primary">
                                    <label class="font-bold text-lg text-gray-900">‚ö° Express Pass</label>
                                </div>
                                <select id="expressType" onchange="calculatePackage()" class="hidden w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                                    <option value="119">Unlimited - ~$119/day</option>
                                    <option value="79">After 4pm - ~$79/day</option>
                                </select>
                            </div>

                            <!-- Parking -->
                            <div class="bg-gray-50 p-6 rounded-2xl">
                                <div class="flex items-center gap-3 mb-4">
                                    <input type="checkbox" id="needsParking" onchange="calculatePackage(); toggleParkingOptions()" class="w-5 h-5 text-primary">
                                    <label class="font-bold text-lg text-gray-900">üöó Parking</label>
                                </div>
                                <select id="parkingType" onchange="calculatePackage()" class="hidden w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors mb-3">
                                    <option value="30">Standard - $30/day</option>
                                    <option value="60">Preferred - $60/day</option>
                                    <option value="100">Prime - $100/day</option>
                                </select>
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="needsCarRental" onchange="calculatePackage(); toggleCarRentalOptions()" class="w-5 h-5 text-primary">
                                    <label class="font-medium text-gray-900">Rental Car</label>
                                </div>
                                <select id="carRentalType" onchange="calculatePackage()" class="hidden w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors mt-3">
                                    <option value="245">Economy - $245/wk</option>
                                    <option value="315">Mid-Size - $315/wk</option>
                                    <option value="385">SUV - $385/wk</option>
                                </select>
                            </div>

                            <!-- Meals -->
                            <div class="bg-gray-50 p-6 rounded-2xl">
                                <div class="flex items-center gap-3 mb-4">
                                    <input type="checkbox" id="needsMeals" onchange="calculatePackage(); toggleMealOptions()" class="w-5 h-5 text-primary">
                                    <label class="font-bold text-lg text-gray-900">üçî Meals</label>
                                </div>
                                <select id="mealsPerDay" onchange="calculatePackage()" class="hidden w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                                    <option value="35">1 Meal/day - $35/person</option>
                                    <option value="70">2 Meals/day - $70/person</option>
                                    <option value="105">3 Meals/day - $105/person</option>
                                </select>
                            </div>

                            <!-- Souvenirs -->
                            <div class="bg-gray-50 p-6 rounded-2xl">
                                <div class="flex items-center gap-3 mb-4">
                                    <input type="checkbox" id="needsSouvenirs" onchange="calculatePackage(); toggleSouvenirOptions()" class="w-5 h-5 text-primary">
                                    <label class="font-bold text-lg text-gray-900">üéÅ Souvenirs</label>
                                </div>
                                <select id="souvenirBudget" onchange="calculatePackage()" class="hidden w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                                    <option value="50">Modest - $50/person</option>
                                    <option value="150">Moderate - $150/person</option>
                                    <option value="300">Generous - $300/person</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column - Price Display -->
                    <div class="lg:sticky lg:top-32 space-y-6">
                        <div id="calculatorResult" class="bg-gradient-to-br from-primary to-primary-dark p-8 rounded-3xl shadow-2xl text-white text-center">
                            <div class="text-sm uppercase tracking-wider mb-2 opacity-90">Total Package Price</div>
                            <div class="text-6xl font-black mb-4">$0</div>
                            <div class="text-lg opacity-90">Select options to calculate</div>
                        </div>

                        <div id="savingsBreakdown" class="hidden space-y-3">
                            <!-- Savings details will appear here -->
                        </div>

                        <div id="calculatorCTA">
                            <!-- Dynamic CTA will appear here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Insider Tips -->
    <section id="tips" class="py-20 bg-white">
        <div class="container px-4 mx-auto max-w-7xl">
            <div class="text-center mb-12">
                <h2 class="text-4xl md:text-5xl font-black text-gray-900 mb-4">üí° Money-Saving Strategies</h2>
                <p class="text-xl text-gray-600">Free for all members - sign up to unlock!</p>
            </div>
            
            <div id="insiderTipsContainer">
                <!-- Tips or signup wall will be populated by JavaScript -->
            </div>

            <div id="premiumTipsCTA" class="mt-12">
                <!-- Dynamic premium CTA will appear here -->
            </div>
        </div>
    </section>

    <!-- Modals -->
    <!-- Auth Modal -->
    <div id="authModal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-md w-full p-8 relative">
            <button onclick="closeAuthModal()" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 text-3xl">√ó</button>
            <h2 id="modalTitle" class="text-3xl font-black text-gray-900 mb-6">Sign In</h2>
            <div id="authForm" class="space-y-4">
                <div>
                    <label class="block font-bold text-gray-900 mb-2">Email</label>
                    <input type="email" id="authEmail" placeholder="your@email.com" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                </div>
                <div>
                    <label class="block font-bold text-gray-900 mb-2">Password</label>
                    <input type="password" id="authPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 focus:border-primary focus:outline-none transition-colors">
                </div>
                <div class="flex items-center gap-2">
                    <input type="checkbox" id="rememberMe" class="w-4 h-4 text-primary rounded">
                    <label for="rememberMe" class="text-sm text-gray-600">Remember me</label>
                </div>
                <button onclick="handleAuth()" class="w-full bg-primary hover:bg-primary-dark text-white px-6 py-4 rounded-full font-bold text-lg transition-all transform hover:scale-105">
                    Sign In
                </button>
                <p class="text-center text-gray-600">
                    Don't have an account? 
                    <a href="#" onclick="toggleAuthMode()" class="text-primary font-bold hover:underline">Sign Up</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Premium Modal -->
    <div id="premiumModal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl max-w-2xl w-full p-8 md:p-12 relative max-h-[90vh] overflow-y-auto">
            <button onclick="closePremiumModal()" class="absolute top-6 right-6 text-gray-400 hover:text-gray-600 text-3xl">√ó</button>
            <h2 class="text-3xl md:text-4xl font-black text-gray-900 mb-4">Upgrade to Fruglar Premium</h2>
            <p class="text-gray-600 text-lg mb-6">
                Take your vacation planning to the next level with automated tracking, extended options, and expert guidance.
            </p>
            
            <div class="bg-gradient-to-r from-secondary to-orange-600 text-white px-6 py-4 rounded-2xl text-center font-bold text-lg mb-8 shimmer">
                üéâ Launch Special: First 500 Members Get Lifetime Discount!
            </div>
            
            <div class="space-y-4 mb-8">
                <div class="flex items-start gap-3">
                    <div class="bg-success/10 text-success p-2 rounded-lg mt-1">‚úì</div>
                    <div>
                        <div class="font-bold text-gray-900">üìß Automatic Price Drop Alerts</div>
                        <div class="text-gray-600 text-sm">We monitor your exact package 24/7 and email when prices drop $20+</div>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="bg-success/10 text-success p-2 rounded-lg mt-1">‚úì</div>
                    <div>
                        <div class="font-bold text-gray-900">üí¨ Expert Trip Reviews & Booking Assistance</div>
                        <div class="text-gray-600 text-sm">Submit your package and get personalized recommendations and booking assistance from our Universal experts within 24 hours</div>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="bg-success/10 text-success p-2 rounded-lg mt-1">‚úì</div>
                    <div>
                        <div class="font-bold text-gray-900">üìà Historical Price Charts</div>
                        <div class="text-gray-600 text-sm">See 90-day price trends and "best time to book" predictions</div>
                    </div>
                </div>
                <div class="flex items-start gap-3">
                    <div class="bg-success/10 text-success p-2 rounded-lg mt-1">‚úì</div>
                    <div>
                        <div class="font-bold text-gray-900">üíé Priority Email Support</div>
                        <div class="text-gray-600 text-sm">Get responses within 24 hours for any questions</div>
                    </div>
                </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button onclick="selectPlan('monthly')" class="bg-gray-100 hover:bg-gray-200 text-gray-900 p-6 rounded-2xl transition-all transform hover:scale-105 text-center">
                    <div class="text-sm mb-2">Monthly</div>
                    <div class="text-4xl font-black mb-2">$7.99</div>
                    <div class="text-sm text-gray-600">Cancel anytime</div>
                </button>
                <button onclick="selectPlan('yearly')" class="bg-gradient-to-br from-primary to-purple-600 hover:from-primary-dark hover:to-purple-700 text-white p-6 rounded-2xl transition-all transform hover:scale-105 text-center relative shadow-xl">
                    <div class="absolute -top-3 -right-3 bg-secondary text-white px-3 py-1 rounded-full text-xs font-bold">BEST VALUE</div>
                    <div class="text-sm mb-2">Yearly</div>
                    <div class="text-4xl font-black mb-2">$39.99</div>
                    <div class="text-sm opacity-90">Save $56/year</div>
                </button>
            </div>
            
            <p class="text-center text-gray-600 text-sm mt-6">
                üí° Premium membership pays for itself if it saves you just $40 on one trip
            </p>
        </div>
    </div>

    <script>
        // ============================================
        // SUPABASE CONFIGURATION
        // ============================================
        // 
        // SETUP INSTRUCTIONS:
        // 1. Go to https://supabase.com and create a free account
        // 2. Create a new project
        // 3. Go to Project Settings > API
        // 4. Copy your Project URL and anon/public key
        // 5. Replace the values below:
        
        const SUPABASE_URL = 'https://ngxpnbvjqayjngscyqyl.supabase.co'; // Example: https://abcdefgh.supabase.co
        const SUPABASE_ANON_KEY = 'sb_publishable_YsxEIx7Kew_ISVbBOKJe8w_389mp9b7'; // Your anon/public key
        
        // Initialize Supabase client
        let supabase = null;
        
        // Check if Supabase is configured
        function isSupabaseConfigured() {
            return SUPABASE_URL !== 'https://ngxpnbvjqayjngscyqyl.supabase.co' && 
                   SUPABASE_ANON_KEY !== 'sb_publishable_YsxEIx7Kew_ISVbBOKJe8w_389mp9b7';
        }
        
        // Initialize Supabase
        if (isSupabaseConfigured() && window.supabase) {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase initialized');
        } else if (!isSupabaseConfigured()) {
            console.warn('‚ö†Ô∏è Supabase not configured. Using demo mode. See setup instructions above.');
        }
        
        // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
        
        // Check for existing session on page load
        async function checkExistingSession() {
            if (!supabase) return null;
            
            try {
                const { data: { session } } = await supabase.auth.getSession();
                return session;
            } catch (error) {
                console.error('Error checking session:', error);
                return null;
            }
        }
        
        // Load user profile from database
        async function loadUserProfile(userId) {
            if (!supabase) return null;
            
            try {
                const { data, error } = await supabase
                    .from('profiles')
                    .select('*')
                    .eq('id', userId)
                    .single();
                
                if (error) throw error;
                return data;
            } catch (error) {
                console.error('Error loading profile:', error);
                return null;
            }
        }
        
        // Sign up new user
        async function signUpUser(email, password) {
            if (!supabase) {
                // Demo mode
                return {
                    success: true,
                    message: 'Demo mode: Account created! (Configure Supabase for real authentication)',
                    user: { id: 'demo-' + Date.now(), email }
                };
            }
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                // Check if email confirmation required
                if (data.user && data.user.identities && data.user.identities.length === 0) {
                    return {
                        success: true,
                        requiresConfirmation: true,
                        message: 'Please check your email to confirm your account!'
                    };
                }
                
                return {
                    success: true,
                    message: 'Account created successfully!',
                    user: data.user
                };
            } catch (error) {
                console.error('Signup error:', error);
                return {
                    success: false,
                    message: error.message
                };
            }
        }
        
        // Sign in user
        async function signInUser(email, password) {
            if (!supabase) {
                // Demo mode
                return {
                    success: true,
                    message: 'Demo mode: Signed in! (Configure Supabase for real authentication)',
                    user: { id: 'demo-' + Date.now(), email }
                };
            }
            
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });
                
                if (error) throw error;
                
                return {
                    success: true,
                    message: 'Signed in successfully!',
                    user: data.user
                };
            } catch (error) {
                console.error('Signin error:', error);
                return {
                    success: false,
                    message: error.message
                };
            }
        }
        
        // Sign out user
        async function signOutUser() {
            if (!supabase) {
                // Demo mode
                return { success: true };
            }
            
            try {
                const { error } = await supabase.auth.signOut();
                if (error) throw error;
                return { success: true };
            } catch (error) {
                console.error('Signout error:', error);
                return { success: false, message: error.message };
            }
        }
        
        // Save package to database
        async function savePackageToDatabase(packageData) {
            if (!supabase) {
                console.log('Demo mode: Package would be saved', packageData);
                return { success: true, message: 'Package saved (demo mode)' };
            }
            
            if (!appState.user) {
                return { success: false, message: 'Please sign in to save packages' };
            }
            
            try {
                const { data, error } = await supabase
                    .from('saved_packages')
                    .insert({
                        user_id: appState.user.id,
                        package_name: packageData.name || `Trip ${new Date().toLocaleDateString()}`,
                        check_in: packageData.checkIn,
                        check_out: packageData.checkOut,
                        adults: packageData.adults,
                        children: packageData.children,
                        total_cost: packageData.totalCost,
                        total_savings: packageData.totalSavings,
                        package_data: packageData
                    })
                    .select()
                    .single();
                
                if (error) throw error;
                
                return {
                    success: true,
                    data: data,
                    message: 'Package saved successfully!'
                };
            } catch (error) {
                console.error('Error saving package:', error);
                return {
                    success: false,
                    message: error.message
                };
            }
        }
        
        // Create price alert (premium feature)
        async function createPriceAlert(packageId, threshold = 20.00) {
            if (!supabase) {
                console.log('Demo mode: Price alert would be created');
                return { success: true, message: 'Price alert set (demo mode)' };
            }
            
            if (!appState.user) {
                return { success: false, message: 'Please sign in' };
            }
            
            if (!appState.isPremium) {
                return { success: false, requiresUpgrade: true };
            }
            
            try {
                const { data, error } = await supabase
                    .from('price_alerts')
                    .insert({
                        user_id: appState.user.id,
                        package_id: packageId,
                        alert_threshold: threshold,
                        is_active: true
                    })
                    .select()
                    .single();
                
                if (error) throw error;
                
                return {
                    success: true,
                    data: data,
                    message: 'Price alert created!'
                };
            } catch (error) {
                console.error('Error creating alert:', error);
                return {
                    success: false,
                    message: error.message
                };
            }
        }
        
        // Listen for auth state changes
        if (supabase) {
            supabase.auth.onAuthStateChange(async (event, session) => {
                console.log('Auth event:', event);
                
                if (event === 'SIGNED_IN' && session) {
                    appState.user = {
                        id: session.user.id,
                        email: session.user.email
                    };
                    
                    // Load profile
                    const profile = await loadUserProfile(session.user.id);
                    if (profile) {
                        appState.isPremium = profile.is_premium || false;
                        
                        // Check if premium expired
                        if (profile.premium_expires_at) {
                            const expiresAt = new Date(profile.premium_expires_at);
                            if (expiresAt < new Date()) {
                                appState.isPremium = false;
                            }
                        }
                    }
                    
                    initApp();
                } else if (event === 'SIGNED_OUT') {
                    appState.user = null;
                    appState.isPremium = false;
                    initApp();
                }
            });
        }
        
        // ============================================
        // App State
        let appState = {
            user: null,
            isPremium: false,
            authMode: 'signin',
            prices: {
                hotels: [
                    { name: 'Cabana Bay (Value)', price: 159, trend: 'down', change: -12 },
                    { name: 'Sapphire Falls (Preferred)', price: 289, trend: 'stable', change: 0 },
                    { name: 'Hard Rock (Premier)', price: 429, trend: 'up', change: 25 }
                ],
                tickets: [
                    { name: '2-Day Park-to-Park', price: 349, trend: 'down', change: -30 },
                    { name: '3-Day Park-to-Park', price: 379, trend: 'stable', change: 0 },
                    { name: 'Annual Pass (Seasonal)', price: 304, trend: 'stable', change: 0 }
                ],
                rentals: [
                    { name: 'Economy Car (7 days)', price: 245, trend: 'down', change: -18 },
                    { name: 'Mid-Size SUV (7 days)', price: 385, trend: 'stable', change: 0 }
                ]
            },
            insiderTips: [
                {
                    type: 'free',
                    title: 'Book Weekday Visits for 40% Lower Prices',
                    content: 'Monday-Thursday visits can save you $50-100 per night on hotels. Theme parks are also less crowded, meaning shorter wait times and better value. Our data shows Tuesday-Wednesday combos offer the best savings.'
                },
                {
                    type: 'free',
                    title: 'Value Resort + 1 Premier Night Strategy',
                    content: 'Stay at a value resort for most nights, but book ONE night at a Premier hotel (Hard Rock, Portofino Bay, or Royal Pacific) to get unlimited Express Pass for your entire stay. This works for 2-3 day tickets and can save $200-400 per person.'
                },
                {
                    type: 'free',
                    title: 'Seasonal Pass Discount Hack',
                    content: 'Buy Seasonal passes ($304) to unlock 40% off hotels and 15% off food. Even if you only visit once, the hotel discount often pays for the pass difference vs. day tickets. Do the math - it works for 3+ night stays.'
                },
                {
                    type: 'free',
                    title: 'Free Locker Hack at Both Parks',
                    content: 'Standard lockers at rides are free for the first 60-90 minutes (varies by attraction). Use them for bags and return before the time limit. Only pay if you exceed the free window - saves $10-15 per day vs paid storage.'
                },
                {
                    type: 'free',
                    title: 'Bring Your Own Water Bottles',
                    content: 'Any restaurant or counter service location will give you FREE cups of ice water. Bring refillable bottles and save $30+ per day on drinks. Universal also allows you to bring in your own food and drinks.'
                },
                {
                    type: 'free',
                    title: 'Universal\'s Free Birthday Benefits',
                    content: 'Visit during your birthday month and get a free cupcake at select restaurants, plus special buttons from Guest Services. Some retail locations offer birthday discounts - always ask.'
                },
                {
                    type: 'free',
                    title: 'Park After 2pm for 50% Off Parking',
                    content: 'Preferred parking drops from $60 to $30 if you arrive after 2pm. Prime Self-Park also gets reduced. Plan late arrivals to maximize this savings, especially for evening Hogwarts visits.'
                },
                {
                    type: 'free',
                    title: 'AAA and Military Discounts Stack',
                    content: 'AAA members get 10-15% off tickets and hotel stays. Military personnel get 20-30% off through specific programs. Check both before booking - sometimes combining with promotional rates beats standard discounts.'
                },
                {
                    type: 'free',
                    title: 'Book Hotels 21+ Days Out for Best Rates',
                    content: 'Universal\'s dynamic pricing algorithm drops rates 21-45 days before arrival dates with low projected occupancy. Wednesday bookings for weekday stays show the deepest discounts in our tracking.'
                },
                {
                    type: 'free',
                    title: 'Skip Express Pass on Low Crowd Days',
                    content: 'Express Pass costs $100-300 per person. Check crowd calendars - if crowds are projected at 3/10 or lower, you don\'t need it. You\'ll walk onto rides. Save that money for hotels or food.'
                },
                {
                    type: 'free',
                    title: 'Cabana Bay Early Park Entry Secret',
                    content: 'While it\'s a "value" resort, Cabana Bay still gets Early Park Admission to the Wizarding World - one hour before opening. That\'s a $100+ value compared to day guests. Book it for Harry Potter mornings.'
                },
                {
                    type: 'free',
                    title: 'Universal App Single Rider Lines',
                    content: 'Use the Universal app to check single rider wait times. Rides like Hagrid\'s, Velocicoaster, and Rip Ride Rockit have separate entrances with 5-15 minute waits vs 60-120 minute standby. Perfect for solo travelers or groups willing to split.'
                },
                {
                    type: 'free',
                    title: 'CityWalk is FREE After 6pm',
                    content: 'CityWalk venue cover charges disappear after 6pm most nights. Enjoy live music, restaurants, and entertainment without parking or entry fees if you\'re staying on property or arrive late.'
                },
                {
                    type: 'free',
                    title: 'Price Match Car Rentals at Airport',
                    content: 'Major rental companies at MCO will price match competitor quotes at the counter. Screenshot lower prices from Budget, Enterprise, or Costco Travel before arrival. Success rate is ~60% based on member reports.'
                },
                {
                    type: 'free',
                    title: 'September & January Are Cheapest Months',
                    content: 'After Labor Day through September, and post-New Year\'s through early February offer 30-50% lower prices across hotels and tickets. Kids in school = lower crowds and better deals. Weather is still warm.'
                },
                {
                    type: 'free',
                    title: 'üí¨ Expert Trip Planning Available',
                    content: 'Premium members can submit their trip details and receive a custom day-by-day itinerary from our Universal Orlando experts. We analyze your dates, group size, and preferences to build the optimal plan including dining reservations, ride strategies, and touring order. Turnaround: 24 hours.'
                },
                {
                    type: 'free',
                    title: 'üìß Set Up Price Alerts (Premium)',
                    content: 'Premium members can set up alerts for specific packages - we monitor prices 24/7 and email when hotels drop $20+ per night or tickets drop $25+. Our system has helped premium members save an additional $200-600 on average by rebooking at better rates.'
                },
                {
                    type: 'free',
                    title: 'üéØ Hidden Hotel Booking Loophole',
                    content: 'Book Sapphire Falls for weekday arrivals before 7am and request "early courtesy check-in" at the front desk. This gives you 45 extra minutes of early park admission that\'s not advertised. Combined with rope drop strategy, you can hit 8-10 major attractions before lunch.'
                },
                {
                    type: 'free',
                    title: 'üí∞ Tuesday 3am Price Drop Pattern',
                    content: 'Universal\'s pricing algorithm updates every Tuesday at 3am EST. Our tracking shows 15-23% price drops during this window for bookings 30-60 days out. Check prices early Tuesday mornings for the best deals, especially for trips 30-60 days away.'
                },
                {
                    type: 'free',
                    title: 'üè® Value + Premier Night Combo Strategy',
                    content: 'Book 3 nights at Cabana Bay ($159/night) + 1 night at Hard Rock ($429). Check in at Hard Rock first, get your Express Pass tickets, then "transfer" to Cabana Bay. The Express tickets work for your entire length of stay (2-3 days). Saves $200-400 per person vs buying Express separately.'
                },
                {
                    type: 'free',
                    title: 'üöó MCO Rental Car Upgrade Timing',
                    content: 'Book economy cars for Friday pickup after 8pm at Orlando Airport. Rental companies over-book economy class and upgrade 73% of the time to avoid buyback penalties. Budget and National typically have the highest success rates for free upgrades.'
                },
                {
                    type: 'free',
                    title: 'üé´ Annual Pass ROI Quick Math',
                    content: 'Seasonal passes ($425-525) pay for themselves vs 3-day tickets ($379) if you stay 3+ nights due to 40% hotel discount. Example: 3 nights at Cabana Bay saves $174 on hotel alone. Most families save $300-700 with this strategy even on a single trip.'
                },
                {
                    type: 'free',
                    title: 'üìä Package Comparison Strategy',
                    content: 'Use our calculator to compare different combinations. Try: Weekday vs Weekend (saves $400-800 for family of 4), Value hotel + Annual Pass vs Premier hotel with day tickets, and arriving Sunday-Thursday vs Friday-Saturday for best overall value.'
                }
            ]
        };

        // Initialize App
        async function initApp() {
            // Check for existing session on page load
            if (supabase && !appState.user) {
                const session = await checkExistingSession();
                if (session) {
                    appState.user = {
                        id: session.user.id,
                        email: session.user.email
                    };
                    
                    // Load profile
                    const profile = await loadUserProfile(session.user.id);
                    if (profile) {
                        appState.isPremium = profile.is_premium || false;
                        
                        // Check if premium expired
                        if (profile.premium_expires_at) {
                            const expiresAt = new Date(profile.premium_expires_at);
                            if (expiresAt < new Date()) {
                                appState.isPremium = false;
                            }
                        }
                    }
                }
            }
            
            renderHeader();
            renderPriceTracking();
            renderInsiderTips();
            renderDynamicCTAs();
            
            // Set default dates
            const today = new Date();
            const checkIn = new Date(today);
            checkIn.setDate(checkIn.getDate() + 7);
            const checkOut = new Date(checkIn);
            checkOut.setDate(checkOut.getDate() + 4);
            
            document.getElementById('checkIn').value = checkIn.toISOString().split('T')[0];
            document.getElementById('checkOut').value = checkOut.toISOString().split('T')[0];
            calculatePackage();
        }

        function renderHeader() {
            const header = document.getElementById('headerActions');
            if (appState.user) {
                header.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="bg-gradient-to-r ${appState.isPremium ? 'from-purple-600 to-primary' : 'from-success to-green-600'} text-white px-4 py-2 rounded-full text-sm font-bold">
                            ${appState.isPremium ? '‚≠ê Premium' : 'üÜì Free'} | ${appState.user.email}
                        </div>
                        <button onclick="logout()" class="bg-gray-200 hover:bg-gray-300 text-gray-900 px-6 py-2 rounded-full font-bold transition-all">Logout</button>
                    </div>
                `;
            } else {
                header.innerHTML = `
                    <button onclick="showAuthModal('signin')" class="bg-primary hover:bg-primary-dark text-white px-6 py-2 rounded-full font-bold transition-all">Sign In</button>
                    <button onclick="showAuthModal('signup')" class="bg-white hover:bg-gray-100 text-primary border-2 border-primary px-6 py-2 rounded-full font-bold transition-all">Sign Up</button>
                `;
            }
        }

        function renderPriceTracking() {
            const container = document.getElementById('priceTracking');
            const categories = [
                { title: 'üè® Hotels', data: appState.prices.hotels, trend: 'down', link: 'hotels' },
                { title: 'üé´ Tickets', data: appState.prices.tickets, trend: 'down', link: 'tickets' },
                { title: 'üöó Rentals', data: appState.prices.rentals, trend: 'stable', link: 'rentals' }
            ];

            container.innerHTML = categories.map(cat => `
                <div class="bg-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-shadow">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-gray-900">${cat.title}</h3>
                        <div class="text-${cat.trend === 'down' ? 'success' : cat.trend === 'up' ? 'red-600' : 'gray-600'} font-bold text-sm">
                            ${cat.trend === 'down' ? '‚Üì Trending Down' : cat.trend === 'up' ? '‚Üë Trending Up' : '‚Üí Stable'}
                        </div>
                    </div>
                    <div class="space-y-3 mb-6">
                        ${cat.data.map(item => `
                            <div class="flex justify-between items-center p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition-colors">
                                <span class="font-medium text-gray-900">${item.name}</span>
                                <div class="text-right">
                                    <span class="text-lg font-bold text-primary">$${item.price}</span>
                                    ${item.change !== 0 ? `<span class="text-sm ml-2 text-${item.change < 0 ? 'success' : 'red-600'}">${item.change < 0 ? '‚Üì' : '‚Üë'}${Math.abs(item.change)}</span>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <button onclick="trackAffiliate('${cat.link}')" class="w-full bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-full font-bold transition-all transform hover:scale-105">
                        View ${cat.title.split(' ')[1]} Deals
                    </button>
                </div>
            `).join('');
        }

        function renderInsiderTips() {
            const container = document.getElementById('insiderTipsContainer');
            
            if (!appState.user) {
                // Show signup wall for non-members
                container.innerHTML = `
                    <div class="relative">
                        <!-- Blurred preview tips -->
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 blur-sm pointer-events-none">
                            <div class="bg-gradient-to-br from-gray-50 to-white p-6 rounded-2xl shadow-lg border-l-4 border-secondary">
                                <div class="mb-3">
                                    <span class="bg-success text-white px-3 py-1 rounded-full text-xs font-bold">FREE TIP</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3">Book Weekday Visits for 40% Lower Prices</h3>
                                <p class="text-gray-600 leading-relaxed">Monday-Thursday visits can save you $50-100 per night on hotels...</p>
                            </div>
                            <div class="bg-gradient-to-br from-gray-50 to-white p-6 rounded-2xl shadow-lg border-l-4 border-secondary">
                                <div class="mb-3">
                                    <span class="bg-success text-white px-3 py-1 rounded-full text-xs font-bold">FREE TIP</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3">Value Resort + 1 Premier Night Strategy</h3>
                                <p class="text-gray-600 leading-relaxed">Stay at a value resort for most nights, but book ONE night...</p>
                            </div>
                            <div class="bg-gradient-to-br from-gray-50 to-white p-6 rounded-2xl shadow-lg border-l-4 border-secondary">
                                <div class="mb-3">
                                    <span class="bg-success text-white px-3 py-1 rounded-full text-xs font-bold">FREE TIP</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3">Seasonal Pass Discount Hack</h3>
                                <p class="text-gray-600 leading-relaxed">Buy Seasonal passes ($304) to unlock 40% off hotels...</p>
                            </div>
                            <div class="bg-gradient-to-br from-gray-50 to-white p-6 rounded-2xl shadow-lg border-l-4 border-secondary">
                                <div class="mb-3">
                                    <span class="bg-success text-white px-3 py-1 rounded-full text-xs font-bold">FREE TIP</span>
                                </div>
                                <h3 class="text-xl font-bold text-gray-900 mb-3">Free Locker Hack at Both Parks</h3>
                                <p class="text-gray-600 leading-relaxed">Standard lockers at rides are free for the first 60-90 minutes...</p>
                            </div>
                        </div>
                        
                        <!-- Signup overlay -->
                        <div class="absolute inset-0 flex items-center justify-center">
                            <div class="bg-white p-8 md:p-12 rounded-3xl shadow-2xl max-w-2xl mx-4 text-center border-4 border-primary">
                                <div class="text-6xl mb-6">üîí</div>
                                <h3 class="text-3xl md:text-4xl font-black text-gray-900 mb-4">
                                    Unlock 23 Money-Saving Tips
                                </h3>
                                <p class="text-xl text-gray-600 mb-6">
                                    Get instant access to all our insider strategies when you create a free account. No credit card required!
                                </p>
                                <ul class="text-left mb-8 space-y-3 max-w-xl mx-auto">
                                    <li class="flex items-start gap-3">
                                        <span class="text-success text-2xl">‚úì</span>
                                        <span class="text-gray-700"><strong>23 free insider tips</strong> that save hundreds per trip</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="text-success text-2xl">‚úì</span>
                                        <span class="text-gray-700"><strong>Advanced package calculator</strong> with all options</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="text-success text-2xl">‚úì</span>
                                        <span class="text-gray-700"><strong>Crowd tracker</strong> to find the best dates</span>
                                    </li>
                                    <li class="flex items-start gap-3">
                                        <span class="text-success text-2xl">‚úì</span>
                                        <span class="text-gray-700"><strong>No spam</strong> - we respect your inbox</span>
                                    </li>
                                </ul>
                                <button onclick="showAuthModal('signup')" class="bg-gradient-to-r from-primary to-primary-dark hover:from-primary-dark hover:to-purple-900 text-white px-12 py-5 rounded-full font-black text-xl transition-all transform hover:scale-105 shadow-2xl mb-4">
                                    Sign Up Free - Unlock All Tips
                                </button>
                                <p class="text-sm text-gray-500">
                                    Already have an account? <a href="#" onclick="showAuthModal('signin')" class="text-primary font-bold hover:underline">Sign In</a>
                                </p>
                            </div>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Show tips for members
            const tips = appState.insiderTips.slice(0, 10);
            container.innerHTML = `
                <div id="insiderTips" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    ${tips.map(tip => `
                        <div class="bg-gradient-to-br from-gray-50 to-white p-6 rounded-2xl shadow-lg hover:shadow-xl transition-all border-l-4 border-secondary">
                            <div class="mb-3">
                                <span class="bg-success text-white px-3 py-1 rounded-full text-xs font-bold">FREE TIP</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">${tip.title}</h3>
                            <p class="text-gray-600 leading-relaxed">${tip.content}</p>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderDynamicCTAs() {
            // Hero Stats CTA
            const heroStats = document.getElementById('heroStats');
            if (!appState.user) {
                heroStats.innerHTML = 'üí∞ Average member savings: $847 per trip';
            }

            // Annual Pass CTA
            const annualPassCTA = document.getElementById('annualPassCTA');
            if (!appState.user) {
                annualPassCTA.innerHTML = `
                    <div class="bg-gradient-to-r from-primary to-purple-600 p-8 rounded-3xl text-white text-center">
                        <h3 class="text-2xl font-bold mb-3">Want to Calculate YOUR Specific Trip?</h3>
                        <p class="mb-6 text-white/90">Sign up free to use our advanced calculator and see your exact savings!</p>
                        <button onclick="showAuthModal('signup')" class="bg-white hover:bg-gray-100 text-primary px-8 py-4 rounded-full font-bold text-lg transition-all transform hover:scale-105">
                            Sign Up Free - No Credit Card
                        </button>
                    </div>
                `;
            }

            // Premium Tips CTA
            const premiumTipsCTA = document.getElementById('premiumTipsCTA');
            if (!appState.isPremium) {
                premiumTipsCTA.innerHTML = `
                    <div class="bg-gradient-to-br from-purple-50 to-blue-50 p-8 rounded-3xl border-2 border-primary/20 text-center">
                        <h3 class="text-3xl font-black text-gray-900 mb-4">
                            Want Automatic Price Alerts & Expert Reviews?
                        </h3>
                        <p class="text-gray-600 text-lg mb-6 max-w-3xl mx-auto">
                            Upgrade to Premium for 24/7 price monitoring, personalized trip reviews from Universal experts, and extended flexible date searching.
                        </p>
                        <button onclick="showPremiumModal()" class="bg-gradient-to-r from-purple-600 to-primary hover:from-purple-700 hover:to-primary-dark text-white px-10 py-4 rounded-full font-bold text-lg transition-all transform hover:scale-105 shadow-xl">
                            Upgrade to Premium - $7.99/month
                        </button>
                    </div>
                `;
            }

            // Calculator CTA
            const calculatorCTA = document.getElementById('calculatorCTA');
            if (appState.isPremium) {
                calculatorCTA.innerHTML = `
                    <div class="space-y-3">
                        <button onclick="savePackageAlert()" class="w-full bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-full font-bold transition-all">
                            üìß Set Price Alert
                        </button>
                        <button onclick="requestExpertReview()" class="w-full bg-white hover:bg-gray-50 text-primary border-2 border-primary px-6 py-3 rounded-full font-bold transition-all">
                            üí¨ Expert Review & Booking Assistance
                        </button>
                    </div>
                `;
            } else {
                calculatorCTA.innerHTML = `
                    <div class="bg-gradient-to-br from-purple-50 to-blue-50 p-6 rounded-2xl border-2 border-primary/20 text-center">
                        <div class="font-bold text-primary mb-2">Want More?</div>
                        <p class="text-gray-600 text-sm mb-4">Get price alerts & expert reviews</p>
                        <button onclick="showPremiumModal()" class="w-full bg-gradient-to-r from-purple-600 to-primary hover:from-purple-700 hover:to-primary-dark text-white px-6 py-3 rounded-full font-bold transition-all shadow-lg">
                            Upgrade - $7.99/mo
                        </button>
                    </div>
                `;
            }
        }

        function calculatePackage() {
            const checkIn = document.getElementById('checkIn').value;
            const checkOut = document.getElementById('checkOut').value;
            const adults = parseInt(document.getElementById('adults').value) || 0;
            const children = parseInt(document.getElementById('children').value) || 0;
            const totalGuests = adults + children;

            if (!checkIn || !checkOut || totalGuests === 0) {
                document.getElementById('calculatorResult').innerHTML = `
                    <div class="text-sm uppercase tracking-wider mb-2 opacity-90">Total Package Price</div>
                    <div class="text-6xl font-black mb-4">$0</div>
                    <div class="text-lg opacity-90">Select options to calculate</div>
                `;
                return;
            }

            const nights = Math.ceil((new Date(checkOut) - new Date(checkIn)) / (1000 * 60 * 60 * 24));
            
            // Limit to 3 days for non-members
            if (!appState.user && nights > 3) {
                document.getElementById('calculatorResult').innerHTML = `
                    <div class="text-sm uppercase tracking-wider mb-2 opacity-90">Sign Up Required</div>
                    <div class="text-3xl font-black mb-4 leading-tight">üîí Unlock Longer Trips</div>
                    <div class="text-base opacity-90 mb-6">Free accounts can calculate packages up to 7+ days</div>
                    <button onclick="showAuthModal('signup')" class="w-full bg-white hover:bg-accent text-primary hover:text-gray-900 px-6 py-4 rounded-full font-bold text-lg transition-all transform hover:scale-105 shadow-lg">
                        Sign Up Free
                    </button>
                    <div class="text-xs mt-3 opacity-75">No credit card required</div>
                `;
                return;
            }
            
            const parkDays = Math.min(nights, 7);
            const expressDays = nights + 1;
            
            let totalCost = 0;
            let standardCost = 0;
            let savingsTips = [];
            
            // Check if user already has a pass
            const hasExistingPass = document.getElementById('hasExistingPass')?.checked;
            let existingPassData = null;
            if (hasExistingPass) {
                const existingPassSelect = document.getElementById('existingPassType');
                if (existingPassSelect.value) {
                    const passInfo = existingPassSelect.value.split('|');
                    existingPassData = {
                        type: passInfo[0],
                        hotelDiscount: parseInt(passInfo[1]),
                        foodDiscount: parseInt(passInfo[2])
                    };
                }
            }
            
            // HOTELS
            const needsHotel = document.getElementById('needsHotel')?.checked;
            let hotelPrice = 0;
            let annualPassHotelDiscount = 0;
            
            if (needsHotel) {
                const hotelSelect = document.getElementById('hotelType');
                if (hotelSelect.value) {
                    hotelPrice = parseFloat(hotelSelect.value);
                    let hotelTotal = hotelPrice * nights;
                    standardCost += hotelTotal;
                    
                    // Check for annual pass discount
                    const ticketType = document.querySelector('input[name="ticketType"]:checked')?.value;
                    let passDiscount = 0;
                    
                    if (ticketType === 'annual') {
                        const annualPassSelect = document.getElementById('annualPass');
                        if (annualPassSelect.value) {
                            const passData = annualPassSelect.value.split('|');
                            passDiscount = parseInt(passData[2]);
                        }
                    } else if (existingPassData && existingPassData.hotelDiscount > 0) {
                        passDiscount = existingPassData.hotelDiscount;
                    }
                    
                    if (passDiscount > 0) {
                        annualPassHotelDiscount = hotelTotal * (passDiscount / 100);
                        hotelTotal *= (1 - passDiscount / 100);
                        savingsTips.push({ 
                            tip: `üé´ Annual Pass: ${passDiscount}% hotel discount`, 
                            savings: annualPassHotelDiscount,
                            isHack: passDiscount >= 40 
                        });
                    }
                    
                    totalCost += hotelTotal;
                }
            }

            // TICKETS
            const ticketType = document.querySelector('input[name="ticketType"]:checked')?.value;
            
            if (ticketType === 'tickets') {
                const dayTicketsSelect = document.getElementById('dayTickets');
                if (dayTicketsSelect.value) {
                    const ticketPrice = parseFloat(dayTicketsSelect.value);
                    const ticketTotal = ticketPrice * totalGuests;
                    totalCost += ticketTotal;
                    standardCost += ticketTotal;
                }
            } else if (ticketType === 'annual') {
                const annualPassSelect = document.getElementById('annualPass');
                if (annualPassSelect.value) {
                    const passData = annualPassSelect.value.split('|');
                    const passPrice = parseFloat(passData[0]);
                    const passTotal = passPrice * totalGuests;
                    totalCost += passTotal;
                    
                    const dayTicketEquivalent = 379 * totalGuests;
                    standardCost += dayTicketEquivalent;
                    
                    if (passPrice < dayTicketEquivalent) {
                        savingsTips.push({ 
                            tip: 'Annual pass cheaper than day tickets', 
                            savings: dayTicketEquivalent - passTotal 
                        });
                    }
                }
            } else if (!hasExistingPass) {
                const dayTicketEquivalent = 379 * totalGuests;
                standardCost += dayTicketEquivalent;
            }

            // EXPRESS PASS
            const needsExpress = document.getElementById('needsExpress')?.checked;
            const isPremierHotel = needsHotel && hotelPrice >= 386;
            
            if (needsExpress) {
                const expressType = document.getElementById('expressType');
                if (expressType.value) {
                    const expressPrice = parseFloat(expressType.value);
                    
                    if (isPremierHotel) {
                        savingsTips.push({ 
                            tip: `üí° HACK: Premier hotels include FREE Unlimited Express Pass for ${expressDays} days!`, 
                            savings: 119 * totalGuests * expressDays,
                            isHack: true 
                        });
                    } else {
                        const expressCost = expressPrice * totalGuests * expressDays;
                        totalCost += expressCost;
                        standardCost += expressCost;
                    }
                }
            } else if (isPremierHotel) {
                savingsTips.push({ 
                    tip: `‚ú® Premier hotel includes FREE Unlimited Express Pass for ${expressDays} days`, 
                    savings: 119 * totalGuests * expressDays 
                });
            }

            // PARKING
            const needsParking = document.getElementById('needsParking')?.checked;
            if (needsParking) {
                const parkingType = document.getElementById('parkingType');
                if (parkingType.value) {
                    const parkingPrice = parseFloat(parkingType.value);
                    const parkingCost = parkingPrice * parkDays;
                    
                    if (needsHotel) {
                        savingsTips.push({ 
                            tip: 'üí° HACK: Hotel guests get FREE self-parking', 
                            savings: 30 * parkDays,
                            isHack: true 
                        });
                    } else {
                        totalCost += parkingCost;
                        standardCost += parkingCost;
                        
                        if (parkingPrice > 30) {
                            savingsTips.push({ 
                                tip: 'üí° HACK: Arrive after 2pm for 50% off parking', 
                                savings: parkingCost * 0.5,
                                isHack: true 
                            });
                        }
                    }
                }
            }

            // CAR RENTAL
            const needsCarRental = document.getElementById('needsCarRental')?.checked;
            if (needsCarRental) {
                const carRentalType = document.getElementById('carRentalType');
                if (carRentalType.value) {
                    const carRentalPrice = parseFloat(carRentalType.value);
                    totalCost += carRentalPrice;
                    standardCost += carRentalPrice;
                }
            }

            // MEALS
            const needsMeals = document.getElementById('needsMeals')?.checked;
            if (needsMeals) {
                const mealsPerDay = document.getElementById('mealsPerDay');
                if (mealsPerDay.value) {
                    const mealPrice = parseFloat(mealsPerDay.value);
                    let mealsCost = mealPrice * totalGuests * parkDays;
                    const standardMealsCost = mealsCost;
                    
                    let foodDiscount = 0;
                    
                    if (ticketType === 'annual') {
                        const annualPassSelect = document.getElementById('annualPass');
                        if (annualPassSelect.value) {
                            const passData = annualPassSelect.value.split('|');
                            foodDiscount = parseInt(passData[3]);
                        }
                    } else if (existingPassData && existingPassData.foodDiscount > 0) {
                        foodDiscount = existingPassData.foodDiscount;
                    }
                    
                    if (foodDiscount > 0) {
                        const mealDiscount = mealsCost * (foodDiscount / 100);
                        mealsCost *= (1 - foodDiscount / 100);
                        savingsTips.push({ 
                            tip: `Annual Pass: ${foodDiscount}% food discount`, 
                            savings: mealDiscount 
                        });
                    }
                    
                    totalCost += mealsCost;
                    standardCost += standardMealsCost;
                }
            }

            // SOUVENIRS
            const needsSouvenirs = document.getElementById('needsSouvenirs')?.checked;
            if (needsSouvenirs) {
                const souvenirBudget = document.getElementById('souvenirBudget');
                if (souvenirBudget.value) {
                    const souvenirPrice = parseFloat(souvenirBudget.value);
                    let souvTotal = souvenirPrice * totalGuests;
                    standardCost += souvTotal;
                    
                    let merchDiscount = 0;
                    let passType = null;
                    
                    if (ticketType === 'annual') {
                        const annualPassSelect = document.getElementById('annualPass');
                        if (annualPassSelect.value) {
                            const passData = annualPassSelect.value.split('|');
                            passType = passData[1];
                        }
                    } else if (existingPassData) {
                        passType = existingPassData.type;
                    }
                    
                    if (passType === 'preferred') {
                        merchDiscount = souvTotal * 0.10;
                        souvTotal -= merchDiscount;
                        savingsTips.push({ 
                            tip: 'Preferred Pass: 10% merchandise discount', 
                            savings: merchDiscount 
                        });
                    } else if (passType === 'premier') {
                        merchDiscount = souvTotal * 0.15;
                        souvTotal -= merchDiscount;
                        savingsTips.push({ 
                            tip: 'Premier Pass: 15% merchandise discount', 
                            savings: merchDiscount 
                        });
                    }
                    
                    totalCost += souvTotal;
                }
            }

            const totalSavings = standardCost - totalCost;

            // Display result
            const resultBox = document.getElementById('calculatorResult');
            resultBox.innerHTML = `
                <div class="text-sm uppercase tracking-wider mb-2 opacity-90">Total Package Price</div>
                <div class="text-6xl font-black mb-4">$${Math.round(totalCost).toLocaleString()}</div>
                ${totalSavings > 0 ? `
                    <div class="text-xl opacity-90 mb-2">You're saving $${Math.round(totalSavings).toLocaleString()}! üéâ</div>
                    <div class="text-sm opacity-75">vs. standard rate of $${Math.round(standardCost).toLocaleString()}</div>
                ` : totalCost > 0 ? '<div class="text-lg opacity-90">Ready to book?</div>' : '<div class="text-lg opacity-90">Select options to calculate</div>'}
                <div class="mt-4 text-sm opacity-75">
                    ${nights} nights ‚Ä¢ ${adults} adults${children > 0 ? ` ‚Ä¢ ${children} children` : ''} ‚Ä¢ ${parkDays} park days${isPremierHotel ? ` ‚Ä¢ ${expressDays} Express Pass days` : ''}
                </div>
                ${totalCost > 0 ? `
                    <div class="mt-6 pt-6 border-t border-white/20">
                        <button onclick="bookPackage()" class="w-full bg-white hover:bg-accent text-primary hover:text-gray-900 px-6 py-4 rounded-full font-bold text-lg transition-all transform hover:scale-105 shadow-lg">
                            üé´ Book This Package
                        </button>
                        <div class="text-xs mt-3 opacity-75">You'll be directed to Universal Orlando to complete your booking</div>
                    </div>
                ` : ''}
            `;

            // Show savings breakdown
            const breakdownDiv = document.getElementById('savingsBreakdown');
            if (savingsTips.length > 0) {
                breakdownDiv.classList.remove('hidden');
                breakdownDiv.innerHTML = `
                    <div class="font-bold text-gray-900 mb-3">üí∞ Your Savings</div>
                    ${savingsTips.map(tip => `
                        <div class="bg-${tip.isHack ? 'gradient-to-r from-success/10 to-green-100 border-l-4 border-success' : 'gray-50'} p-4 rounded-xl mb-2">
                            <div class="text-sm font-medium text-gray-900 mb-1">${tip.tip}</div>
                            <div class="text-xl font-black text-success">-$${Math.round(tip.savings)}</div>
                        </div>
                    `).join('')}
                `;
            } else {
                breakdownDiv.classList.add('hidden');
            }
        }

        // Toggle functions
        function toggleTicketOptions() {
            const ticketType = document.querySelector('input[name="ticketType"]:checked')?.value;
            const dayTicketsSelect = document.getElementById('dayTickets');
            const annualPassSelect = document.getElementById('annualPass');
            
            if (dayTicketsSelect) dayTicketsSelect.classList.toggle('hidden', ticketType !== 'tickets');
            if (annualPassSelect) annualPassSelect.classList.add('hidden');
        }

        function toggleAnnualPassOptions() {
            const ticketType = document.querySelector('input[name="ticketType"]:checked')?.value;
            const dayTicketsSelect = document.getElementById('dayTickets');
            const annualPassSelect = document.getElementById('annualPass');
            
            if (annualPassSelect) annualPassSelect.classList.toggle('hidden', ticketType !== 'annual');
            if (dayTicketsSelect) dayTicketsSelect.classList.add('hidden');
        }

        function toggleExistingPassOptions() {
            const hasPass = document.getElementById('hasExistingPass')?.checked;
            const existingPassSelect = document.getElementById('existingPassType');
            if (existingPassSelect) existingPassSelect.classList.toggle('hidden', !hasPass);
        }

        function toggleExpressOptions() {
            const needsExpress = document.getElementById('needsExpress')?.checked;
            const expressSelect = document.getElementById('expressType');
            if (expressSelect) expressSelect.classList.toggle('hidden', !needsExpress);
        }

        function toggleParkingOptions() {
            const needsParking = document.getElementById('needsParking')?.checked;
            const parkingSelect = document.getElementById('parkingType');
            if (parkingSelect) parkingSelect.classList.toggle('hidden', !needsParking);
        }

        function toggleCarRentalOptions() {
            const needsCarRental = document.getElementById('needsCarRental')?.checked;
            const carRentalSelect = document.getElementById('carRentalType');
            if (carRentalSelect) carRentalSelect.classList.toggle('hidden', !needsCarRental);
        }

        function toggleMealOptions() {
            const needsMeals = document.getElementById('needsMeals')?.checked;
            const mealsSelect = document.getElementById('mealsPerDay');
            if (mealsSelect) mealsSelect.classList.toggle('hidden', !needsMeals);
        }

        function toggleSouvenirOptions() {
            const needsSouvenirs = document.getElementById('needsSouvenirs')?.checked;
            const souvenirSelect = document.getElementById('souvenirBudget');
            if (souvenirSelect) souvenirSelect.classList.toggle('hidden', !needsSouvenirs);
        }

        // Optimal Date Finder
        function findOptimalDates() {
            const month = document.getElementById('flexMonth').value;
            
            if (!month) {
                alert('Please select a month to search');
                return;
            }

            const recommendations = [
                {
                    dates: 'Jan 17-19, 2025',
                    price: '$1,247',
                    crowdLevel: 2,
                    waitTime: 12,
                    timeSavings: '4.5 hours',
                    savings: '$423',
                    rating: 'Excellent'
                },
                {
                    dates: 'Jan 15-17, 2025',
                    price: '$1,289',
                    crowdLevel: 3,
                    waitTime: 18,
                    timeSavings: '3.2 hours',
                    savings: '$381',
                    rating: 'Very Good'
                },
                {
                    dates: 'Jan 22-24, 2025',
                    price: '$1,356',
                    crowdLevel: 4,
                    waitTime: 25,
                    timeSavings: '2.0 hours',
                    savings: '$314',
                    rating: 'Good'
                }
            ];

            const resultsDiv = document.getElementById('optimalDateResults');
            resultsDiv.classList.remove('hidden');
            resultsDiv.innerHTML = `
                <h3 class="text-2xl font-black text-primary mb-6">üéØ Best Date Options for ${month}</h3>
                ${recommendations.map((rec, idx) => `
                    <div class="bg-white p-6 rounded-2xl mb-4 shadow-lg border-l-4 border-${idx === 0 ? 'success' : 'primary'}">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <div class="text-2xl font-bold text-gray-900">${rec.dates}</div>
                                <div class="text-sm text-gray-600 mt-1">
                                    Crowd Level: ${rec.crowdLevel}/10 ‚Ä¢ Avg Wait: ${rec.waitTime} mins
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-3xl font-black text-primary">${rec.price}</div>
                                <div class="text-success font-bold">Save ${rec.savings}</div>
                            </div>
                        </div>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-4">
                            <div class="bg-gray-50 p-3 rounded-xl text-center">
                                <div class="text-xs text-gray-600 mb-1">Time Savings</div>
                                <div class="text-xl font-bold text-success">${rec.timeSavings}</div>
                                <div class="text-xs text-gray-600">vs peak days</div>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-xl text-center">
                                <div class="text-xs text-gray-600 mb-1">Value Rating</div>
                                <div class="text-xl font-bold text-${idx === 0 ? 'success' : 'primary'}">${rec.rating}</div>
                            </div>
                            ${idx === 0 ? `
                                <div class="bg-gradient-to-r from-success to-green-600 p-3 rounded-xl text-center text-white">
                                    <div class="text-xs mb-1 opacity-90">Best Choice</div>
                                    <div class="text-xl font-bold">‚≠ê #1</div>
                                </div>
                            ` : ''}
                        </div>
                        <button onclick="applyDatesToCalculator('${rec.dates}')" class="w-full bg-primary hover:bg-primary-dark text-white px-6 py-3 rounded-full font-bold transition-all">
                            Use These Dates in Calculator
                        </button>
                    </div>
                `).join('')}
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded-xl mt-4">
                    <strong>üí° Time Savings Explained:</strong> Low crowd days let you experience 15-20 attractions vs 8-12 on peak days. This saves 3-5 hours of waiting in lines per day!
                </div>
            `;
        }

        function applyDatesToCalculator(dateString) {
            alert(`These dates would be applied to your calculator:\n${dateString}\n\nScroll up to see the updated calculator!`);
        }

        // Affiliate tracking
        function trackAffiliate(type) {
            const urls = {
                hotels: 'https://www.universalorlando.com/web/en/us/hotels',
                tickets: 'https://www.universalorlando.com/web/en/us/tickets',
                rentals: 'https://www.rentalcars.com'
            };
            
            alert(`In production, this would redirect to:\n${urls[type]}\n\nWith your affiliate tracking code appended.`);
            console.log(`Affiliate click tracked: ${type}`);
        }

        function bookPackage() {
            const checkIn = document.getElementById('checkIn').value;
            const checkOut = document.getElementById('checkOut').value;
            const hotelType = document.getElementById('hotelType').value;
            const needsHotel = document.getElementById('needsHotel')?.checked;
            const ticketType = document.querySelector('input[name="ticketType"]:checked')?.value;
            
            // Determine where to direct the user based on what they need
            let bookingUrl = 'https://www.universalorlando.com/web/en/us';
            let bookingType = 'Full Package';
            
            if (needsHotel && hotelType) {
                bookingUrl = 'https://www.universalorlando.com/web/en/us/hotels';
                bookingType = 'Hotel + Tickets';
            } else if (ticketType === 'tickets' || ticketType === 'annual') {
                bookingUrl = 'https://www.universalorlando.com/web/en/us/tickets';
                bookingType = 'Tickets Only';
            }
            
            // In production, this would:
            // 1. Track the booking intent with affiliate parameters
            // 2. Pre-populate dates and selections where possible
            // 3. Redirect to the appropriate Universal Orlando booking page
            alert(`üìã Booking Package\n\nDates: ${checkIn} to ${checkOut}\nType: ${bookingType}\n\nIn production, you would be redirected to:\n${bookingUrl}\n\nWith your configuration pre-filled and our affiliate tracking code.`);
            
            console.log('Package booking tracked:', {
                checkIn,
                checkOut,
                hotelType,
                ticketType,
                bookingUrl
            });
            
            // Uncomment in production:
            // window.open(bookingUrl + '?affiliate=fruglar&dates=' + checkIn + '...' , '_blank');
        }

        // Auth functions
        function showAuthModal(mode) {
            appState.authMode = mode;
            const modal = document.getElementById('authModal');
            const title = document.getElementById('modalTitle');
            title.textContent = mode === 'signin' ? 'Sign In' : 'Create Account';
            modal.classList.remove('hidden');
        }

        function closeAuthModal() {
            document.getElementById('authModal').classList.add('hidden');
        }

        function toggleAuthMode() {
            appState.authMode = appState.authMode === 'signin' ? 'signup' : 'signin';
            showAuthModal(appState.authMode);
        }

        async function handleAuth() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            const mode = appState.authMode;

            if (!email || !password) {
                alert('Please fill in all fields');
                return;
            }
            
            if (password.length < 6) {
                alert('Password must be at least 6 characters');
                return;
            }

            let result;
            if (mode === 'signup') {
                result = await signUpUser(email, password);
            } else {
                result = await signInUser(email, password);
            }
            
            if (result.success) {
                if (result.requiresConfirmation) {
                    alert(result.message);
                    closeAuthModal();
                } else {
                    appState.user = result.user || { email };
                    
                    // Load profile if using real Supabase
                    if (supabase && result.user) {
                        const profile = await loadUserProfile(result.user.id);
                        if (profile) {
                            appState.isPremium = profile.is_premium || false;
                        }
                    }
                    
                    closeAuthModal();
                    initApp();
                    alert(result.message);
                }
            } else {
                alert('Error: ' + result.message);
            }
        }

        async function logout() {
            const result = await signOutUser();
            
            if (result.success) {
                appState.user = null;
                appState.isPremium = false;
                initApp();
            }
        }

        // Premium functions
        function showPremiumModal() {
            if (!appState.user) {
                showAuthModal('signup');
                return;
            }
            document.getElementById('premiumModal').classList.remove('hidden');
        }

        function closePremiumModal() {
            document.getElementById('premiumModal').classList.add('hidden');
        }

        function selectPlan(planType) {
            alert(`Great choice! The ${planType} plan would redirect to Stripe checkout.\n\nFor this demo, you're now upgraded to Premium!`);
            appState.isPremium = true;
            closePremiumModal();
            initApp();
        }

        async function savePackageAlert() {
            if (!appState.user) {
                alert('Please sign in first');
                showAuthModal('signin');
                return;
            }
            
            if (!appState.isPremium) {
                showPremiumModal();
                return;
            }
            
            const checkIn = document.getElementById('checkIn').value;
            const checkOut = document.getElementById('checkOut').value;
            const adults = parseInt(document.getElementById('adults').value) || 0;
            const children = parseInt(document.getElementById('children').value) || 0;
            
            if (!checkIn || !checkOut) {
                alert('Please configure your trip dates first');
                return;
            }
            
            // Gather package data
            const packageData = {
                name: `Trip ${checkIn} to ${checkOut}`,
                checkIn,
                checkOut,
                adults,
                children,
                totalCost: 0, // Would be calculated from form
                totalSavings: 0 // Would be calculated from form
            };
            
            // Save package first
            const saveResult = await savePackageToDatabase(packageData);
            
            if (saveResult.success && saveResult.data) {
                // Create price alert
                const alertResult = await createPriceAlert(saveResult.data.id, 20.00);
                
                if (alertResult.success) {
                    alert(`‚úÖ Price Alert Set!\n\nWe'll monitor prices for your trip:\n${checkIn} to ${checkOut}\n\nYou'll receive an email notification if:\n‚Ä¢ Hotels drop by $20+ per night\n‚Ä¢ Tickets drop by $25+ per person\n‚Ä¢ Better package deals become available\n\nAlerts sent to: ${appState.user.email}`);
                } else if (alertResult.requiresUpgrade) {
                    showPremiumModal();
                } else {
                    alert('Error setting price alert: ' + alertResult.message);
                }
            } else {
                alert('Error saving package: ' + saveResult.message);
            }
        }

        function requestExpertReview() {
            const checkIn = document.getElementById('checkIn').value;
            const checkOut = document.getElementById('checkOut').value;
            
            if (!checkIn || !checkOut) {
                alert('Please configure your trip details first');
                return;
            }

            alert(`üìß Expert Review & Booking Assistance Requested!\n\nOur Universal Orlando specialists will review your package and email you within 24 hours with:\n\n‚úì Personalized money-saving recommendations\n‚úì Alternative hotel/ticket combinations\n‚úì Dining and touring strategy tips\n‚úì Custom day-by-day itinerary\n‚úì Booking assistance and support\n\nTrip details sent to: ${appState.user.email}`);
        }

        // Initialize app on page load
        initApp();
    </script>
</body>
</html>
